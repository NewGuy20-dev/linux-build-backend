{
  "base": "arch",
  "architecture": "x86_64",
  "kernel": {
    "version": "linux-lts",
    "customFlags": ["kaslr", "stack-protector"],
    "modules": {
      "enable": ["btrfs", "dm-crypt", "apparmor"],
      "disable": ["bluetooth", "pcspkr", "floppy"]
    }
  },
  "init": "systemd",
  "filesystem": {
    "root": "btrfs",
    "encryption": "luks2",
    "compression": true,
    "partitions": [
      {
        "mount": "/boot",
        "size": "1G"
      },
      {
        "mount": "/home", 
        "size": "50G",
        "encrypted": true
      },
      {
        "mount": "/var",
        "size": "20G",
        "encrypted": true
      }
    ],
    "lvm": false,
    "raid": false
  },
  "display": {
    "server": "wayland",
    "compositor": "hyprland",
    "bar": "waybar",
    "launcher": "rofi",
    "terminal": "kitty",
    "theme": "catppuccin-dark"
  },
  "packages": [
    "base", "linux-lts", "linux-firmware", "btrfs-progs", "cryptsetup",
    "docker", "python", "python-pip", "nodejs", "npm", "rust", "go",
    "git", "hyprland", "waybar", "rofi", "kitty", "firefox",
    "networkmanager", "systemd-resolved", "nftables", "apparmor",
    "postgresql", "redis", "nginx", "zsh", "vim", "curl", "wget",
    "prometheus", "grafana", "netdata", "borgbackup", "fail2ban"
  ],
  "securityFeatures": {
    "mac": ["apparmor"],
    "firewall": {
      "backend": "nftables", 
      "policy": "deny",
      "rules": [
        {
          "port": 22,
          "protocol": "tcp",
          "action": "allow"
        },
        {
          "port": 443,
          "protocol": "tcp", 
          "action": "allow"
        },
        {
          "port": 80,
          "protocol": "tcp",
          "action": "allow"
        }
      ]
    },
    "kernelHardening": ["kaslr", "stack-protector"]
  },
  "services": {
    "enable": ["NetworkManager", "systemd-resolved", "docker", "postgresql", "redis", "nginx", "apparmor", "fail2ban"],
    "disable": ["bluetooth", "sshd"]
  },
  "backup": {
    "tool": "borg",
    "schedule": "daily"
  },
  "customization": {
    "shell": "zsh",
    "dotfiles": {
      "enabled": true,
      "repo": "https://github.com/user/quantumforge-dotfiles.git"
    }
  },
  "postInstall": {
    "scripts": [
      "#!/bin/bash",
      "# QuantumForge OS Post-Install Configuration",
      "echo '=== QuantumForge OS Setup Starting ==='",
      "",
      "# System optimization",
      "echo 'vm.swappiness=10' >> /etc/sysctl.conf",
      "echo 'vm.vfs_cache_pressure=50' >> /etc/sysctl.conf",
      "echo 'net.core.default_qdisc=fq' >> /etc/sysctl.conf",
      "echo 'net.ipv4.tcp_congestion_control=bbr' >> /etc/sysctl.conf",
      "",
      "# Install AUR helper (yay)",
      "pacman -S --noconfirm base-devel git",
      "git clone https://aur.archlinux.org/yay.git /tmp/yay",
      "cd /tmp/yay && makepkg -si --noconfirm",
      "",
      "# Install additional development tools from AUR",
      "yay -S --noconfirm vscodium-bin k3s-bin poetry starship",
      "yay -S --noconfirm ollama-bin jupyter-lab",
      "",
      "# Setup Oh My Zsh for root and default user",
      "sh -c \"$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\" \"\" --unattended",
      "",
      "# Configure Hyprland desktop environment",
      "mkdir -p /etc/skel/.config/hypr",
      "cat > /etc/skel/.config/hypr/hyprland.conf << 'EOF'",
      "# QuantumForge OS Hyprland Configuration",
      "monitor=,preferred,auto,auto",
      "exec-once = waybar &",
      "exec-once = mako &",
      "bind = SUPER, Return, exec, kitty",
      "bind = SUPER, D, exec, rofi -show drun",
      "bind = SUPER, Q, killactive",
      "bind = SUPER, M, exit",
      "EOF",
      "",
      "# Setup Waybar configuration",
      "mkdir -p /etc/skel/.config/waybar",
      "cat > /etc/skel/.config/waybar/config << 'EOF'",
      "{",
      "  \"layer\": \"top\",",
      "  \"modules-left\": [\"hyprland/workspaces\"],",
      "  \"modules-center\": [\"clock\"],",
      "  \"modules-right\": [\"cpu\", \"memory\", \"network\", \"battery\"]",
      "}",
      "EOF",
      "",
      "# Configure security hardening",
      "systemctl enable apparmor",
      "systemctl enable fail2ban",
      "",
      "# Setup monitoring stack",
      "systemctl enable prometheus grafana netdata",
      "",
      "# Configure Btrfs snapshots",
      "pacman -S --noconfirm snapper",
      "snapper -c root create-config /",
      "systemctl enable snapper-timeline.timer snapper-cleanup.timer",
      "",
      "# Setup AI/ML environment",
      "pip install --break-system-packages torch tensorflow jupyter ollama-python",
      "",
      "# Configure PostgreSQL",
      "sudo -u postgres initdb -D /var/lib/postgres/data",
      "systemctl enable postgresql",
      "",
      "# Setup Nginx with security headers",
      "cat > /etc/nginx/nginx.conf << 'EOF'",
      "events { worker_connections 1024; }",
      "http {",
      "  add_header X-Frame-Options DENY;",
      "  add_header X-Content-Type-Options nosniff;",
      "  add_header X-XSS-Protection \"1; mode=block\";",
      "  server {",
      "    listen 80;",
      "    return 301 https://$server_name$request_uri;",
      "  }",
      "}",
      "EOF",
      "",
      "# Generate system documentation",
      "cat > /home/user/QuantumForge-README.md << 'EOF'",
      "# QuantumForge OS",
      "",
      "## Advanced Security-Hardened Linux Distribution",
      "",
      "### Features:",
      "- **Base**: Arch Linux with Linux LTS kernel",
      "- **Security**: AppArmor MAC, nftables firewall, LUKS2 encryption",
      "- **Desktop**: Hyprland (Wayland) with Waybar and Rofi",
      "- **Development**: Docker, K3s, Python, Node.js, Rust, Go, VSCodium",
      "- **AI/ML**: PyTorch, TensorFlow, Jupyter Lab, Ollama",
      "- **Monitoring**: Prometheus, Grafana, Netdata",
      "- **Backup**: Borg with automated snapshots",
      "",
      "### Quick Start:",
      "```bash",
      "# Check system status",
      "systemctl status",
      "",
      "# Start development environment",
      "code .",
      "",
      "# Launch AI/ML workspace",
      "jupyter lab",
      "",
      "# Monitor system",
      "htop",
      "```",
      "",
      "### Security Notes:",
      "- Firewall allows only SSH (22), HTTP (80), HTTPS (443)",
      "- AppArmor profiles active for all network services",
      "- Automatic security updates enabled",
      "- Fail2ban protecting SSH access",
      "",
      "Built with ❤️ for developers, researchers, and security professionals.",
      "EOF",
      "",
      "chown user:user /home/user/QuantumForge-README.md",
      "",
      "echo '=== QuantumForge OS Setup Completed Successfully! ==='",
      "echo 'Reboot recommended to activate all security features.'"
    ]
  }
}
